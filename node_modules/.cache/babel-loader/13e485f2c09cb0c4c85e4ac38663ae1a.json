{"ast":null,"code":"import { useReducer, useEffect } from 'react';\nimport axios from 'axios';\nconst ACTIONS = {\n  MAKE_REQUEST: 'make-request',\n  GET_DATA: 'get-data',\n  ERROR: 'error',\n  UPDATE_HAS_NEXT_PAGE: 'update-has-next-page'\n};\nconst BASE_URL = \"https://cors-anywhere.herokuapp.com/https://jobs.github.com/positions.json\";\n\nfunction reducer(state, action) {\n  switch (action.type) {\n    case ACTIONS.MAKE_REQUEST:\n      return {\n        loading: true,\n        jobs: []\n      };\n\n    case ACTIONS.GET_DATA:\n      return { ...state,\n        loading: false,\n        jobs: action.payload.jobs\n      };\n\n    case ACTIONS.ERROR:\n      return { ...state,\n        loading: false,\n        error: action.payload.error,\n        jobs: []\n      };\n\n    case ACTIONS.UPDATE_HAS_NEXT_PAGE:\n      return { ...state,\n        hasNextPage: action.payload.hasNextPage\n      };\n\n    default:\n      return state;\n  }\n}\n\nexport default function useFetchJobs(params, page) {\n  const [state, dispach] = useReducer(reducer, {\n    jobs: [],\n    loading: true\n  });\n  useEffect(() => {\n    const cancelToken1 = axios.CancelToken.source;\n    dispach({\n      type: ACTIONS.MAKE_REQUEST\n    });\n    axios.get(BASE_URL, {\n      cancelToken: cancelToken1.token,\n      params: {\n        markdown: true,\n        page: page,\n        ...params\n      }\n    }).then(res => {\n      dispach({\n        type: ACTIONS.GET_DATA,\n        payload: {\n          jobs: res.data\n        }\n      });\n    }).catch(e => {\n      if (axios.isCancel(e)) return;\n      dispach({\n        type: ACTIONS.ERROR,\n        payload: {\n          error: e\n        }\n      });\n    });\n    const cancelToken2 = axios.CancelToken.source;\n    axios.get(BASE_URL, {\n      cancelToken: cancelToken2.token,\n      params: {\n        markdown: true,\n        page: page + 1,\n        ...params\n      }\n    }).then(res => {\n      dispach({\n        type: ACTIONS.UPDATE_HAS_NEXT_PAGE,\n        payload: {\n          hasNextPage: res.data.length !== 0\n        }\n      });\n    }).catch(e => {\n      if (axios.isCancel(e)) return;\n      dispach({\n        type: ACTIONS.ERROR,\n        payload: {\n          error: e\n        }\n      });\n    });\n    return () => {\n      cancelToken1.cancel();\n      cancelToken2.cancel();\n    };\n  }, [params, page]);\n  return state;\n}","map":{"version":3,"sources":["/Users/anismedini/Desktop/code-js/github-job/src/useFetchJobs.js"],"names":["useReducer","useEffect","axios","ACTIONS","MAKE_REQUEST","GET_DATA","ERROR","UPDATE_HAS_NEXT_PAGE","BASE_URL","reducer","state","action","type","loading","jobs","payload","error","hasNextPage","useFetchJobs","params","page","dispach","cancelToken1","CancelToken","source","get","cancelToken","token","markdown","then","res","data","catch","e","isCancel","cancelToken2","length","cancel"],"mappings":"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","sourcesContent":["\nimport {useReducer, useEffect} from 'react'\nimport axios from 'axios'\n\nconst ACTIONS = {\n    MAKE_REQUEST: 'make-request', \n    GET_DATA: 'get-data',\n    ERROR:'error',\n    UPDATE_HAS_NEXT_PAGE: 'update-has-next-page'\n}\nconst BASE_URL= \"https://cors-anywhere.herokuapp.com/https://jobs.github.com/positions.json\";\n\nfunction reducer(state , action) {\n    switch (action.type) {\n        case ACTIONS.MAKE_REQUEST:\n            return {loading: true, jobs:[]}\n        case ACTIONS.GET_DATA:\n            return {...state,loading:false,jobs:action.payload.jobs}\n        case ACTIONS.ERROR:\n           return {...state,loading:false,error:action.payload.error,jobs:[]}\n        case ACTIONS.UPDATE_HAS_NEXT_PAGE :\n            return {...state, hasNextPage: action.payload.hasNextPage} \n        default:\n            return state;\n    }\n}\nexport default function useFetchJobs(params, page) {\n    const [state, dispach] = useReducer(reducer, {jobs:[],loading:true,})\n\n    useEffect(()=>{\n        const cancelToken1 =axios.CancelToken.source\n            dispach({type:ACTIONS.MAKE_REQUEST})\n            axios.get(BASE_URL,{\n                cancelToken: cancelToken1.token,\n                params: {markdown: true, page:page,...params}\n            }).then(res =>{\n                dispach({type:ACTIONS.GET_DATA, payload:{jobs:res.data}})\n            }).catch (e=>{\n                if(axios.isCancel(e)) return;\n                dispach({type: ACTIONS.ERROR, payload:{error: e}})\n            })\n\n\n            const cancelToken2 =axios.CancelToken.source\n            axios.get(BASE_URL,{\n                cancelToken: cancelToken2.token,\n                params: {markdown: true, page:page +1,...params}\n            }).then(res =>{\n                dispach({type:ACTIONS.UPDATE_HAS_NEXT_PAGE, payload:{hasNextPage:res.data.length !==0}})\n            }).catch (e=>{\n                if(axios.isCancel(e)) return;\n                dispach({type: ACTIONS.ERROR, payload:{error: e}})\n            })\n\n            return () => {\n                cancelToken1.cancel();\n                cancelToken2.cancel();\n            }\n\n\n    },[params,page])\n\n    return state\n\n    \n\n}"]},"metadata":{},"sourceType":"module"}